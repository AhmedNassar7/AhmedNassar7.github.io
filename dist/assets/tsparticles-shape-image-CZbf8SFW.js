import{M as U,N as S,x as M}from"./tsparticles-engine-B56Pkamw.js";const A=[0,4,2,1],O=[8,8,4,2];class N{constructor(e){this.pos=0,this.data=new Uint8ClampedArray(e)}getString(e){const a=this.data.slice(this.pos,this.pos+e);return this.pos+=a.length,a.reduce((n,o)=>n+String.fromCharCode(o),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let e="",a=0;do{a=this.data[this.pos++];for(let n=a;--n>=0;e+=String.fromCharCode(this.data[this.pos++]));}while(a!==0);return e}readSubBlocksBin(){let e=0,a=0;for(let o=0;(e=this.data[this.pos+o])!==0;o+=e+1)a+=e;const n=new Uint8Array(a);for(let o=0;(e=this.data[this.pos++])!==0;)for(let d=e;--d>=0;n[o++]=this.data[this.pos++]);return n}skipSubBlocks(){for(;this.data[this.pos]!==0;this.pos+=this.data[this.pos]+1);this.pos++}}function P(i,e){const a=[];for(let n=0;n<e;n++)a.push({r:i.data[i.pos],g:i.data[i.pos+1],b:i.data[i.pos+2]}),i.pos+=3;return a}async function j(i,e,a,n,o,d){switch(i.nextByte()){case 59:return!0;case 44:await async function(t,h,s,c,f){const r=h.frames[c(!0)];r.left=t.nextTwoBytes(),r.top=t.nextTwoBytes(),r.width=t.nextTwoBytes(),r.height=t.nextTwoBytes();const l=t.nextByte(),T=!(128&~l),R=!(64&~l);r.sortFlag=!(32&~l),r.reserved=(24&l)>>>3;const _=1<<1+(7&l);T&&(r.localColorTable=P(t,_));const v=p=>{const{r:u,g:y,b:g}=(T?r.localColorTable:h.globalColorTable)[p];return{r:u,g:y,b:g,a:p===f(null)?s?~~((u+y+g)/3):0:255}},b=(()=>{try{return new ImageData(r.width,r.height,{colorSpace:"srgb"})}catch(p){if(p instanceof DOMException&&p.name==="IndexSizeError")return null;throw p}})();if(b==null)throw new EvalError("GIF frame size is to large");const I=t.nextByte(),E=t.readSubBlocksBin(),x=1<<I,m=(p,u)=>{const y=p>>>3,g=7&p;return(E[y]+(E[y+1]<<8)+(E[y+2]<<16)&(1<<u)-1<<g)>>>g};if(R){for(let p=0,u=I+1,y=0,g=[[0]],B=0;B<4;B++)if(A[B]<r.height)for(let D=0,w=0;;){const k=p;if(p=m(y,u),y+=u+1,p===x){u=I+1,g.length=x+2;for(let C=0;C<g.length;C++)g[C]=C<x?[C]:[]}else{p>=g.length?g.push(g[k].concat(g[k][0])):k!==x&&g.push(g[k].concat(g[p][0]));for(let C=0;C<g[p].length;C++){const{r:F,g:$,b:z,a:G}=v(g[p][C]);b.data.set([F,$,z,G],A[B]*r.width+O[B]*w+D%(4*r.width)),D+=4}g.length===1<<u&&u<12&&u++}if(D===4*r.width*(w+1)&&(w++,A[B]+O[B]*w>=r.height))break}r.image=b,r.bitmap=await createImageBitmap(b)}else{for(let p=0,u=I+1,y=0,g=[[0]],B=-4;;){const D=p;if(p=m(y,u),y+=u,p===x){u=I+1,g.length=x+2;for(let w=0;w<g.length;w++)g[w]=w<x?[w]:[]}else{if(p===x+1)break;p>=g.length?g.push(g[D].concat(g[D][0])):D!==x&&g.push(g[D].concat(g[p][0]));for(let w=0;w<g[p].length;w++){const{r:k,g:C,b:F,a:$}=v(g[p][w]);b.data.set([k,C,F,$],B+=4)}g.length>=1<<u&&u<12&&u++}}r.image=b,r.bitmap=await createImageBitmap(b)}}(i,e,a,n,o);break;case 33:await async function(t,h,s,c){switch(t.nextByte()){case 249:{const f=h.frames[s(!1)];t.pos++;const r=t.nextByte();f.GCreserved=(224&r)>>>5,f.disposalMethod=(28&r)>>>2,f.userInputDelayFlag=!(2&~r);const l=!(1&~r);f.delayTime=10*t.nextTwoBytes();const T=t.nextByte();l&&c(T),t.pos++;break}case 255:{t.pos++;const f={identifier:t.getString(8),authenticationCode:t.getString(3),data:t.readSubBlocksBin()};h.applicationExtensions.push(f);break}case 254:h.comments.push([s(!1),t.readSubBlocks()]);break;case 1:if(h.globalColorTable.length===0)throw new EvalError("plain text extension without global color table");t.pos++,h.frames[s(!1)].plainTextData={left:t.nextTwoBytes(),top:t.nextTwoBytes(),width:t.nextTwoBytes(),height:t.nextTwoBytes(),charSize:{width:t.nextTwoBytes(),height:t.nextTwoBytes()},foregroundColor:t.nextByte(),backgroundColor:t.nextByte(),text:t.readSubBlocks()};break;default:t.skipSubBlocks()}}(i,e,n,o);break;default:throw new EvalError("undefined block found")}return!1}const Q=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;async function L(i){return new Promise(e=>{i.loading=!0;const a=new Image;i.element=a,a.addEventListener("load",()=>{i.loading=!1,e()}),a.addEventListener("error",()=>{i.element=void 0,i.error=!0,i.loading=!1,U().error(`${S} loading image: ${i.source}`),e()}),a.src=i.source})}async function W(i){if(i.type==="gif"){i.loading=!0;try{i.gifData=await async function(e,a,n){n||(n=!1);const o=await fetch(e);if(!o.ok&&o.status===404)throw new EvalError("file not found");const d=await o.arrayBuffer(),t={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},h=new N(new Uint8ClampedArray(d));if(h.getString(6)!=="GIF89a")throw new Error("not a supported GIF file");t.width=h.nextTwoBytes(),t.height=h.nextTwoBytes();const s=h.nextByte(),c=!(128&~s);t.colorRes=(112&s)>>>4,t.sortFlag=!(8&~s);const f=1<<1+(7&s),r=h.nextByte();t.pixelAspectRatio=h.nextByte(),t.pixelAspectRatio!==0&&(t.pixelAspectRatio=(t.pixelAspectRatio+15)/64),c&&(t.globalColorTable=P(h,f));const l=(()=>{try{return new ImageData(t.width,t.height,{colorSpace:"srgb"})}catch(m){if(m instanceof DOMException&&m.name==="IndexSizeError")return null;throw m}})();if(l==null)throw new Error("GIF frame size is to large");const{r:T,g:R,b:_}=t.globalColorTable[r];l.data.set(c?[T,R,_,255]:[0,0,0,0]);for(let m=4;m<l.data.length;m*=2)l.data.copyWithin(m,0,m);t.backgroundImage=l;let v=-1,b=!0,I=-1;const E=m=>(m&&(b=!0),v),x=m=>(m!=null&&(I=m),I);try{do b&&(t.frames.push({left:0,top:0,width:0,height:0,disposalMethod:0,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),v++,I=-1,b=!1);while(!await j(h,t,n,E,x));t.frames.length--;for(const m of t.frames){if(m.userInputDelayFlag&&m.delayTime===0){t.totalTime=1/0;break}t.totalTime+=m.delayTime}return t}catch(m){throw m instanceof EvalError?new Error(`error while parsing frame ${v} "${m.message}"`):m}}(i.source),i.gifLoopCount=function(e){for(const a of e.applicationExtensions)if(a.identifier+a.authenticationCode==="NETSCAPE2.0")return a.data[1]+(a.data[2]<<8);return NaN}(i.gifData)??0,i.gifLoopCount===0&&(i.gifLoopCount=1/0)}catch{i.error=!0}i.loading=!1}else await L(i)}async function q(i){if(i.type!=="svg")return void await L(i);i.loading=!0;const e=await fetch(i.source);e.ok?i.svgData=await e.text():(U().error(`${S} Image not found`),i.error=!0),i.loading=!1}function H(i,e,a,n){var t;const o=function(h,s,c){const{svgData:f}=h;if(!f)return"";const r=M(s,c);if(f.includes("fill"))return f.replace(Q,()=>r);const l=f.indexOf(">");return`${f.substring(0,l)} fill="${r}"${f.substring(l)}`}(i,a,((t=n.opacity)==null?void 0:t.value)??1),d={color:a,gif:e.gif,data:{...i,svgData:o},loaded:!1,ratio:e.width/e.height,replaceColor:e.replaceColor??e.replace_color,source:e.src};return new Promise(h=>{const s=new Blob([o],{type:"image/svg+xml"}),c=URL||window.URL||window.webkitURL||window,f=c.createObjectURL(s),r=new Image;r.addEventListener("load",()=>{d.loaded=!0,d.element=r,h(d),c.revokeObjectURL(f)}),r.addEventListener("error",async()=>{c.revokeObjectURL(f);const l={...i,error:!1,loading:!0};await L(l),d.loaded=!0,d.element=l.element,h(d)}),r.src=f})}class J{constructor(e){this.loadImageShape=async a=>{if(!this._engine.loadImage)throw new Error(`${S} image shape not initialized`);await this._engine.loadImage({gif:a.gif,name:a.name,replaceColor:a.replaceColor??a.replace_color??!1,src:a.src})},this._engine=e}addImage(e){this._engine.images||(this._engine.images=[]),this._engine.images.push(e)}draw(e,a,n,o,d){const t=a.image,h=t==null?void 0:t.element;if(t){if(e.globalAlpha=o,t.gif&&t.gifData){const s=new OffscreenCanvas(t.gifData.width,t.gifData.height),c=s.getContext("2d");if(!c)throw new Error("could not create offscreen canvas context");c.imageSmoothingQuality="low",c.imageSmoothingEnabled=!1,c.clearRect(0,0,s.width,s.height),a.gifLoopCount===void 0&&(a.gifLoopCount=t.gifLoopCount??0);let f=a.gifFrame??0;const r={x:.5*-t.gifData.width,y:.5*-t.gifData.height},l=t.gifData.frames[f];if(a.gifTime===void 0&&(a.gifTime=0),!l.bitmap)return;switch(e.scale(n/t.gifData.width,n/t.gifData.height),l.disposalMethod){case 4:case 5:case 6:case 7:case 0:c.drawImage(l.bitmap,l.left,l.top),e.drawImage(s,r.x,r.y),c.clearRect(0,0,s.width,s.height);break;case 1:c.drawImage(l.bitmap,l.left,l.top),e.drawImage(s,r.x,r.y);break;case 2:c.drawImage(l.bitmap,l.left,l.top),e.drawImage(s,r.x,r.y),c.clearRect(0,0,s.width,s.height),t.gifData.globalColorTable.length===0?c.putImageData(t.gifData.frames[0].image,r.x+l.left,r.y+l.top):c.putImageData(t.gifData.backgroundImage,r.x,r.y);break;case 3:{const T=c.getImageData(0,0,s.width,s.height);c.drawImage(l.bitmap,l.left,l.top),e.drawImage(s,r.x,r.y),c.clearRect(0,0,s.width,s.height),c.putImageData(T,0,0)}}if(a.gifTime+=d.value,a.gifTime>l.delayTime){if(a.gifTime-=l.delayTime,++f>=t.gifData.frames.length){if(--a.gifLoopCount<=0)return;f=0,c.clearRect(0,0,s.width,s.height)}a.gifFrame=f}e.scale(t.gifData.width/n,t.gifData.height/n)}else if(h){const s=t.ratio,c={x:-n,y:-n};e.drawImage(h,c.x,c.y,2*n,2*n/s)}e.globalAlpha=1}}getSidesCount(){return 12}async init(e){const a=e.actualOptions;if(a.preload&&this._engine.loadImage)for(const n of a.preload)await this._engine.loadImage(n)}loadShape(e){if(e.shape!=="image"&&e.shape!=="images")return;this._engine.images||(this._engine.images=[]);const a=e.shapeData;this._engine.images.find(n=>n.name===a.name||n.source===a.src)||this.loadImageShape(a).then(()=>{this.loadShape(e)})}particleInit(e,a){if(a.shape!=="image"&&a.shape!=="images")return;this._engine.images||(this._engine.images=[]);const n=this._engine.images,o=a.shapeData,d=a.getFillColor(),t=n.find(s=>s.name===o.name||s.source===o.src);if(!t)return;const h=o.replaceColor??o.replace_color??t.replaceColor;t.loading?setTimeout(()=>{this.particleInit(e,a)}):(async()=>{let s;s=t.svgData&&d?await H(t,o,d,a):{color:d,data:t,element:t.element,gif:t.gif,gifData:t.gifData,gifLoopCount:t.gifLoopCount,loaded:!0,ratio:o.width&&o.height?o.width/o.height:t.ratio??1,replaceColor:h,source:o.src},s.ratio||(s.ratio=1);const c={image:s,fill:o.fill??a.fill,close:o.close??a.close};a.image=c.image,a.fill=c.fill,a.close=c.close})()}}class K{constructor(){this.src="",this.gif=!1}load(e){e&&(e.gif!==void 0&&(this.gif=e.gif),e.height!==void 0&&(this.height=e.height),e.name!==void 0&&(this.name=e.name),e.replaceColor!==void 0&&(this.replaceColor=e.replaceColor),e.src!==void 0&&(this.src=e.src),e.width!==void 0&&(this.width=e.width))}}class V{constructor(e){this.id="imagePreloader",this._engine=e}getPlugin(){return{}}loadOptions(e,a){if(!a||!a.preload)return;e.preload||(e.preload=[]);const n=e.preload;for(const o of a.preload){const d=n.find(t=>t.name===o.name||t.src===o.src);if(d)d.load(o);else{const t=new K;t.load(o),n.push(t)}}}needsPlugin(){return!0}}async function Y(i,e=!0){(function(n){n.loadImage||(n.loadImage=async o=>{if(!o.name&&!o.src)throw new Error(`${S} no image source provided`);if(n.images||(n.images=[]),!n.images.find(d=>d.name===o.name||d.source===o.src))try{const d={gif:o.gif??!1,name:o.name??o.src,source:o.src,type:o.src.substring(o.src.length-3),error:!1,loading:!0,replaceColor:o.replaceColor,ratio:o.width&&o.height?o.width/o.height:void 0};n.images.push(d),await(o.gif?W:o.replaceColor?q:L)(d)}catch{throw new Error(`${S} ${o.name??o.src} not found`)}})})(i);const a=new V(i);await i.addPlugin(a,e),await i.addShape(["image","images"],new J(i),e)}export{Y as l};
